@{
    ViewData["Title"] = "Homeix Admin Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container-fluid px-4 mt-4 mb-5">

    <div class="text-center mb-5">
        <h1 class="fw-bold">
            <i class="bi bi-graph-up-arrow me-2"></i> Admin Analytics Dashboard
        </h1>
        <p class="text-muted">Real-time platform analytics</p>
    </div>

    <div class="row g-4 mb-4">

        <div class="col-lg-4">
            <div class="card shadow-sm p-3">
                <h6 class="text-muted fw-bold">Users by Role</h6>
                <canvas id="usersChart"></canvas>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm p-3">
                <h6 class="text-muted fw-bold">Posts Overview</h6>
                <canvas id="postsChart"></canvas>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm p-3">
                <h6 class="text-muted fw-bold">Job Status</h6>
                <canvas id="jobsChart"></canvas>
            </div>
        </div>

    </div>

    <div class="row g-4">

        <div class="col-lg-8">
            <div class="card shadow-sm p-3">
                <h6 class="text-muted fw-bold">Monthly Revenue (JD)</h6>
                <canvas id="paymentsChart"></canvas>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm p-3">
                <h6 class="text-muted fw-bold">Ratings</h6>
                <canvas id="ratingsChart"></canvas>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        new Chart(document.getElementById('usersChart'), {
            type: 'bar',
            data: {
                labels: @Html.Raw(ViewBag.UsersByRoleLabels ?? "[]"),
                datasets: [{
                    data: @Html.Raw(ViewBag.UsersByRoleCounts ?? "[]"),
                    backgroundColor: '#0d6efd'
                }]
            }
        });

        new Chart(document.getElementById('postsChart'), {
            type: 'doughnut',
            data: {
                labels: ['Customer Posts', 'Worker Posts'],
                datasets: [{
                    data: [@ViewBag.CustomerPostsCount, @ViewBag.WorkerPostsCount],
                    backgroundColor: ['#0dcaf0', '#ffc107']
                }]
            }
        });

        new Chart(document.getElementById('jobsChart'), {
            type: 'pie',
            data: {
                labels: @Html.Raw(ViewBag.JobStatusLabels ?? "[]"),
                datasets: [{
                    data: @Html.Raw(ViewBag.JobStatusCounts ?? "[]"),
                    backgroundColor: ['#0dcaf0', '#0d6efd', '#198754', '#dc3545']
                }]
            }
        });

        new Chart(document.getElementById('paymentsChart'), {
            type: 'line',
            data: {
                labels: @Html.Raw(ViewBag.PaymentMonths ?? "[]"),
                datasets: [{
                    data: @Html.Raw(ViewBag.PaymentTotals ?? "[]"),
                    borderColor: '#6610f2',
                    fill: true
                }]
            }
        });

        new Chart(document.getElementById('ratingsChart'), {
            type: 'bar',
            data: {
                labels: @Html.Raw(ViewBag.RatingLabels ?? "[]"),
                datasets: [{
                    data: @Html.Raw(ViewBag.RatingCounts ?? "[]"),
                    backgroundColor: '#fd7e14'
                }]
            },
            options: { indexAxis: 'y' }
        });
    </script>
}
