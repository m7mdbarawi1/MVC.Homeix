@model Homeix.Models.User
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["Register"];
}

<div class="container-fluid page-wrapper mt-5 pt-4">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="page-title fw-bold">
                @Localizer["CreateAccount"]
            </h1>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow-sm border-0 rounded-3">
                <div class="card-body p-4">

                    <!-- IMPORTANT: enctype added -->
                    <form asp-action="Register" method="post" enctype="multipart/form-data">

                        @Html.AntiForgeryToken()

                        <!-- Validation Summary -->
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        @if (ViewBag.Error != null)
                        {
                            <div class="alert alert-danger py-2">
                                <i class="bi bi-exclamation-circle"></i> @ViewBag.Error
                            </div>
                        }

                        <!-- ================= PROFILE IMAGE ================= -->
                        <div class="text-center mb-4">
                            <label for="ProfileImageInput" style="cursor:pointer;">
                                <img id="profilePreview"
                                     src="~/images/default-user.png"
                                     class="rounded-circle shadow-sm"
                                     style="width:120px; height:120px; object-fit:cover;"
                                     title="@Localizer["UploadProfilePicture"]" />
                            </label>

                            <input type="file"
                                   id="ProfileImageInput"
                                   name="ProfileImage"
                                   accept="image/*"
                                   hidden />
                        </div>

                        <!-- Full Name -->
                        <div class="mb-3">
                            <label asp-for="FullName" class="form-label fw-semibold">
                                @Localizer["FullName"]
                            </label>
                            <input asp-for="FullName"
                                   class="form-control"
                                   placeholder="@Localizer["EnterFullName"]"
                                   pattern="^[A-Za-z .]+$"
                                   title="@Localizer["FullNameRule"]" />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>

                        <!-- Email -->
                        <div class="mb-3">
                            <label asp-for="Email" class="form-label fw-semibold">
                                @Localizer["Email"]
                            </label>
                            <input asp-for="Email"
                                   type="email"
                                   class="form-control"
                                   placeholder="@Localizer["EmailPlaceholder"]" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <!-- Phone Number -->
                        <div class="mb-3">
                            <label asp-for="PhoneNumber" class="form-label fw-semibold">
                                @Localizer["PhoneNumber"]
                            </label>
                            <input asp-for="PhoneNumber"
                                   class="form-control"
                                   placeholder="@Localizer["PhonePlaceholder"]"
                                   pattern="^\d{10}$"
                                   title="@Localizer["PhoneRule"]" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <!-- Password -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">
                                @Localizer["Password"]
                            </label>
                            <input name="Password"
                                   type="password"
                                   class="form-control"
                                   minlength="8"
                                   required
                                   placeholder="@Localizer["PasswordPlaceholder"]" />
                            <div class="form-text">
                                @Localizer["PasswordRule"]
                            </div>
                        </div>

                        <!-- Register Button -->
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary fw-semibold">
                                <i class="bi bi-person-plus"></i>
                                @Localizer["Register"]
                            </button>
                        </div>

                        <!-- Login Link -->
                        <p class="text-center mt-3 mb-0">
                            @Localizer["AlreadyHaveAccount"]
                            <a asp-controller="Account"
                               asp-action="Login"
                               class="fw-semibold">
                                @Localizer["LoginHere"]
                            </a>.
                        </p>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const imageInput = document.getElementById('ProfileImageInput');
            const preview = document.getElementById('profilePreview');

            preview.addEventListener('click', () => imageInput.click());

            imageInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (!file || !file.type.startsWith('image')) return;

                const reader = new FileReader();
                reader.onload = ev => preview.src = ev.target.result;
                reader.readAsDataURL(file);
            });

            const nameInput = document.getElementById('FullName');
            const phoneInput = document.getElementById('PhoneNumber');

            if (nameInput) {
                nameInput.addEventListener('input', e => {
                    e.target.value = e.target.value.replace(/[^A-Za-z .]/g, '');
                });
            }

            if (phoneInput) {
                phoneInput.addEventListener('input', e => {
                    e.target.value = e.target.value.replace(/\D/g, '');
                });
            }
        });
    </script>
}
