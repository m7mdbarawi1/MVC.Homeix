@model Homeix.Models.Subscription

@{
    ViewData["Title"] = "Edit Subscription";
}

<div class="container-fluid mt-4">

    <!-- HEADER -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="fw-bold page-title">Edit Subscription</h1>
            <p class="text-muted mb-0">
                Update subscription details for the selected user.
            </p>
        </div>
    </div>

    <!-- FORM -->
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">

                    <form asp-action="Edit" method="post" id="editForm">
                        @Html.AntiForgeryToken()

                        <input type="hidden" asp-for="SubscriptionId" />

                        <!-- USER -->
                        <div class="mb-3">
                            <label asp-for="UserId" class="form-label fw-semibold"></label>
                            <select asp-for="UserId"
                                    class="form-select"
                                    asp-items="ViewBag.UserId">
                            </select>
                        </div>

                        <!-- PLAN -->
                        <div class="mb-3">
                            <label asp-for="PlanId" class="form-label fw-semibold"></label>

                            <select asp-for="PlanId"
                                    class="form-select"
                                    id="planSelect">
                                @foreach (var item in (SelectList)ViewBag.PlanId)
                                {
                                    <option value="@item.Value"
                                            data-duration="@item.Text.Split('-').Last()">
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- START DATE (LOCKED) -->
                        <div class="mb-3">
                            <label asp-for="StartDate" class="form-label fw-semibold"></label>
                            <input asp-for="StartDate"
                                   type="date"
                                   class="form-control"
                                   readonly />
                        </div>

                        <!-- END DATE (LOCKED) -->
                        <div class="mb-3">
                            <label asp-for="EndDate" class="form-label fw-semibold"></label>
                            <input asp-for="EndDate"
                                   type="date"
                                   class="form-control"
                                   readonly />
                        </div>

                        <!-- STATUS -->
                        <div class="mb-3">
                            <label asp-for="Status" class="form-label fw-semibold"></label>
                            <select asp-for="Status" class="form-select">
                                <option value="Active">Active</option>
                                <option value="Expired">Expired</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>

                        <!-- ACTIONS -->
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                Save
                            </button>

                            <button type="button"
                                    class="btn btn-secondary"
                                    onclick="history.back()">
                                Back
                            </button>
                        </div>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const planSelect = document.getElementById("planSelect");
            const startInput = document.querySelector("[name='StartDate']");
            const endInput = document.querySelector("[name='EndDate']");

            planSelect.addEventListener("change", function () {

                const selected = this.options[this.selectedIndex];
                const duration = selected.dataset.duration;

                if (!duration) return;

                const start = new Date();
                const end = new Date();

                end.setDate(start.getDate() + parseInt(duration));

                startInput.value = start.toISOString().split("T")[0];
                endInput.value = end.toISOString().split("T")[0];
            });
        });
    </script>
}
