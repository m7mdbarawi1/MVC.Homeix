@model Homeix.Models.User

@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["UserProfileTitle"];
}

<div class="container-fluid mt-4">

    <!-- HEADER -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="fw-bold">@Localizer["UserProfileTitle"]</h1>
        </div>
    </div>

    <!-- SINGLE UNIFIED CARD -->
    <div class="row justify-content-center">
        <div class="col-md-9 col-lg-8">

            <div class="card shadow-sm">
                <div class="card-body">

                    <!-- PROFILE IMAGE -->
                    <div class="text-center mb-4">
                        <img src="@(string.IsNullOrEmpty(Model.ProfilePicture)
                            ? Url.Content("~/images/default-user.png")
                            : Url.Content("~/uploads/profile/" + Model.ProfilePicture))"
                             class="rounded-circle border shadow"
                             style="width:150px;height:150px;object-fit:cover;" />
                    </div>

                    <!-- USER INFO -->
                    <dl class="row mb-4">

                        <dt class="col-sm-3 fw-bold">@Localizer["FullName"]</dt>
                        <dd class="col-sm-9">@Model.FullName</dd>

                        <dt class="col-sm-3 fw-bold">@Localizer["Email"]</dt>
                        <dd class="col-sm-9">@Model.Email</dd>

                        <dt class="col-sm-3 fw-bold">@Localizer["Phone"]</dt>
                        <dd class="col-sm-9">
                            @(string.IsNullOrWhiteSpace(Model.PhoneNumber)
                                ? Localizer["None"].Value
                                : Model.PhoneNumber)
                        </dd>

                        <dt class="col-sm-3 fw-bold">@Localizer["Role"]</dt>
                        <dd class="col-sm-9">@Model.Role?.RoleName</dd>

                    </dl>

                    <hr />

                    <!-- RATINGS & REVIEWS -->
                    <h5 class="fw-semibold mb-3">
                        @Localizer["RatingsAndReviews"]
                        <span class="text-muted">
                            (@(Model.RatingRatedUsers == null ? 0 : Model.RatingRatedUsers.Count))
                        </span>
                    </h5>

                    @if (Model.RatingRatedUsers != null && Model.RatingRatedUsers.Any())
                    {
                        @foreach (var rating in Model.RatingRatedUsers
                       .OrderByDescending(r => r.CreatedAt))
                        {
                            <div class="border-bottom pb-3 mb-3">

                                <!-- RATER -->
                                <div class="fw-semibold">
                                    @rating.RaterUser?.FullName
                                </div>

                                <!-- STARS -->
                                <div class="text-warning mb-1">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i class="bi @(i <= rating.RatingValue
                                            ? "bi-star-fill"
                                            : "bi-star")"></i>
                                    }
                                </div>

                                <!-- COMMENT -->
                                <div class="text-muted">
                                    @(string.IsNullOrWhiteSpace(rating.Review)
                                        ? Localizer["NoCommentProvided"].Value
                                        : rating.Review)
                                </div>

                                <!-- DATE -->
                                <div class="text-secondary small mt-1">
                                    @rating.CreatedAt.ToString("dd MMM yyyy")
                                </div>

                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted mb-0">
                            @Localizer["NoRatingsYet"]
                        </p>
                    }

                </div>

                <!-- FOOTER -->
                <div class="card-footer text-center">
                    <button type="button"
                            onclick="history.back()"
                            class="btn btn-secondary btn-sm">
                        <i class="bi bi-arrow-left"></i>
                        @Localizer["Back"]
                    </button>
                </div>

            </div>

        </div>
    </div>

</div>
