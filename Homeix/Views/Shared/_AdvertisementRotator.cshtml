@model List<Homeix.Models.Advertisement>

@if (Model != null && Model.Any())
{
    var ad = Model.First();

    <div class="modal fade"
         id="adModal"
         tabindex="-1"
         aria-hidden="true">

        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 rounded-4 shadow-lg overflow-hidden">

                <!-- ================= HEADER ================= -->
                <div class="modal-header border-0 d-flex justify-content-between align-items-center">
                    <span class="badge bg-warning text-dark px-3 py-2">
                        Advertisement
                    </span>

                    <!-- ❌ CLOSE BUTTON -->
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>

                <!-- ================= BODY ================= -->
                <div class="modal-body text-center px-4 pb-4">

                    @if (!string.IsNullOrWhiteSpace(ad.ImagePath))
                    {
                        <img src="@ad.ImagePath"
                             class="img-fluid rounded-3 mb-4"
                             style="max-height: 420px; object-fit: contain;"
                             alt="Advertisement" />
                    }
                    else
                    {
                        <div class="text-muted mb-4">
                            No advertisement image available
                        </div>
                    }

                    <div class="d-inline-block px-4 py-2 rounded-pill bg-light text-dark fw-semibold">
                        Closing in <span id="adCountdown">5</span> seconds
                    </div>

                </div>

            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const modalElement = document.getElementById("adModal");
            if (!modalElement) return;

            const modal = new bootstrap.Modal(modalElement, {
                backdrop: false,
                keyboard: true
            });

            let showIntervalSeconds = 10;
            let autoCloseSeconds = 5;
            let timer = null;
            let reopenTimer = null;

            function showAd() {
                modal.show();

                let seconds = autoCloseSeconds;
                const counter = document.getElementById("adCountdown");
                if (counter) counter.textContent = seconds;

                timer = setInterval(() => {
                    seconds--;
                    if (counter) counter.textContent = seconds;

                    if (seconds <= 0) {
                        clearInterval(timer);
                        modal.hide();
                    }
                }, 1000);
            }

            modalElement.addEventListener("hidden.bs.modal", () => {
                clearInterval(timer);

                // 🔁 Reopen after X seconds
                reopenTimer = setTimeout(() => {
                    showAd();
                }, showIntervalSeconds * 1000);
            });

            // 🚀 First show
            showAd();
        });
    </script>

}
